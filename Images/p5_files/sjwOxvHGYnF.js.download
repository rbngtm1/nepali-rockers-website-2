if (self.CavalryLogger) { CavalryLogger.start_js(["HOGWo"]); }

__d("CurationCaretNux",["csx","cx","ge","tidyEvent","Arbiter","AsyncRequest","CSS","DataStore","DOM","Event","NavigationMessage","Parent","Rect"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j="div._1zpr",k="div._6ks",l="._3x-2 img.img",m="span.text_exposed_link",n="_5jmm",o="CurationCaretNux_instance",p="CurationCaretNux_caretMenuLoaded",q=100,r="LINK_WELCOME",s="VIDEO_WELCOME",t="POST_SAVE_WELCOME",u="PHOTO_WELCOME",v="caret_nux",w="save_option_nux",x="seen",y="dismissed",z="focus",A="click",B="scroll",C=false,D=null,E=null;function F(G,H,I,J,K,L){"use strict";__p&&__p();var M=c("ge")(J);if(M){this.container=M;this.caret=I;this.caretNux=G.instance;this.caretNuxData=G;this.saveOptionNux=H.instance;this.saveOptionNuxData=H;this.allowAutoplayNux=L;this.popoverTriggered=false;var N=c("Parent").byClass(M,n);c("DataStore").set(N,o,this);switch(K){case r:this.$CurationCaretNux1();break;case s:this.$CurationCaretNux1();this.$CurationCaretNux2();this.$CurationCaretNux3();break;case t:this.$CurationCaretNux4();break;case u:this.$CurationCaretNux5();break}c("Arbiter").subscribeOnce(c("NavigationMessage").NAVIGATION_BEGIN,function(){this.caretNux&&this.caretNux.hide();this.saveOptionNux&&this.saveOptionNux.hide()}.bind(this))}}F.prototype.$CurationCaretNux1=function(){"use strict";__p&&__p();var G=c("DOM").scry(this.container,j);if(G.length>0)c("tidyEvent")([c("Event").listen(G[0],"click",function(){__p&&__p();if(C||this.videoPlaying)return;this.caretNux.subscribe("show",function(){this.$CurationCaretNux6()}.bind(this));this.caretNux.subscribe("hide",function(){this.$CurationCaretNux7();if(C){this.$CurationCaretNux8(v,x);this.$CurationCaretNux8(v,y)}}.bind(this));this.$CurationCaretNux9();this.interactionTime=0;setTimeout(function(){if(!this.$CurationCaretNux10()){C=true;this.caretNux.show()}}.bind(this),this.caretNuxData.min_consume_duration);setTimeout(function(){if(!this.$CurationCaretNux10()){C=false;this.caretNux.hide()}}.bind(this),this.caretNuxData.max_consume_duration);var H=Date.now();setTimeout(function(){this.$CurationCaretNux11(function(){if(!this.interactionTime)this.interactionTime=Date.now()-H}.bind(this))}.bind(this),0)}.bind(this))])};F.prototype.$CurationCaretNux2=function(){"use strict";var G=c("DOM").scry(this.container,k);if(G.length>0)c("tidyEvent")([c("Event").listen(G[0],"click",function(){this.videoPlaying=true}.bind(this))])};F.prototype.$CurationCaretNux3=function(){"use strict";__p&&__p();if(!this.allowAutoplayNux)return;if(E===null)E=this.caretNuxData.min_consume_duration;if(D===null&&!C)D=c("Arbiter").subscribe("flash/updateStatus",function(event,G){if(!C&&E!==null&&G.position*1e3>E){var H=c("Parent").byClass(c("ge")(G.divID),n),I=c("DataStore").get(H,o);if(I){C=true;I.caretNux.show();I.$CurationCaretNux6();c("Arbiter").unsubscribe(D)}}})};F.prototype.$CurationCaretNux4=function(){"use strict";var G=c("DOM").scry(this.container,m);if(G.length>0)c("tidyEvent")([c("Event").listen(G[0],"click",function(){if(C)return;C=true;this.caretNux.show();this.$CurationCaretNux6()}.bind(this))])};F.prototype.$CurationCaretNux5=function(){"use strict";__p&&__p();var G=c("DOM").scry(this.container,l);G.forEach(function(H){__p&&__p();var I=c("Parent").byTag(H,"a");if(!I)return;c("Event").listen(I,"click",function(){__p&&__p();if(C)return;var J=c("Arbiter").subscribe("PhotoSnowlift.OPEN",function(){var K=Date.now(),L=c("Arbiter").subscribe("PhotoSnowlift.CLOSE",function(){var M=Date.now()-K;if(M>this.caretNuxData.min_consume_duration&&M<this.caretNuxData.max_consume_duration){C=true;this.caretNux.show();this.$CurationCaretNux6()}c("Arbiter").unsubscribe(L)}.bind(this));c("Arbiter").unsubscribe(J)}.bind(this))}.bind(this))},this)};F.prototype.$CurationCaretNux10=function(){"use strict";return this.interactionTime&&this.interactionTime>0};F.prototype.$CurationCaretNux6=function(){"use strict";__p&&__p();this.caretClickListener=c("Event").listen(this.caret,"click",function(){this.caretNux.hide();if(this.saveOptionNux){this.popoverTriggered=true;this.$CurationCaretNux12()}}.bind(this));var G=false,H=function(I){if(G||I===A||!this.caretNux.isShown())return;var J=c("Rect").getViewportWithoutScrollbarsBounds(),K=c("Rect").getElementBounds(this.caretNux.getContentRoot());K=K.sub(0,q);if(J.contains(K)){this.$CurationCaretNux8(v,x);G=true}}.bind(this);H();this.$CurationCaretNux9();this.$CurationCaretNux11(H)};F.prototype.$CurationCaretNux7=function(){"use strict";this.caretClickListener.remove();this.$CurationCaretNux13()};F.prototype.$CurationCaretNux12=function(){"use strict";__p&&__p();if(this.$CurationCaretNux14()&&this.popoverTriggered)setTimeout(function(){__p&&__p();var G=c("DOM").scry(document,"li.save_caret_menu_item");for(var H=0;H<G.length;H++){var I=G[H],J=c("Parent").byClass(I,"uiLayer");if(J&&c("CSS").shown(J)){this.saveOptionNux.setContext(I);break}}this.saveOptionNux.show();this.$CurationCaretNux8(w,x);var K=c("DataStore").get(this.caret,"Popover");K&&K.subscribeOnce("hide",function(){this.saveOptionNux.hide()}.bind(this))}.bind(this),0)};F.prototype.$CurationCaretNux8=function(G,H){"use strict";__p&&__p();var I=void 0;if(G===v)I=this.caretNuxData;else if(G===w)I=this.saveOptionNuxData;else throw new Error("Invalid nux type");var J=void 0;if(H===x){J=I.seen_uri;I.seen_uri=null}else if(H===y){J=I.dismiss_uri;I.dismiss_uri=null}else throw new Error("Invalid impression type");if(J){var K=new(c("AsyncRequest"))(J);if(this.interactionTime&&G===v)K.setData({interaction_time:this.interactionTime});K.send()}};F.prototype.$CurationCaretNux11=function(G){"use strict";this.$CurationCaretNux15.push(G)};F.prototype.$CurationCaretNux16=function(G){"use strict";this.$CurationCaretNux15.forEach(function(H){H.call(this,G)},this)};F.prototype.$CurationCaretNux9=function(){"use strict";if(!this.$CurationCaretNux17){this.$CurationCaretNux15=[];this.$CurationCaretNux17=[c("Event").listen(window,"click",this.$CurationCaretNux16.bind(this,A)),c("Event").listen(window,"focus",this.$CurationCaretNux16.bind(this,z)),c("Event").listen(window,"scroll",this.$CurationCaretNux16.bind(this,B))]}};F.prototype.$CurationCaretNux13=function(G){"use strict";if(this.$CurationCaretNux17){while(this.$CurationCaretNux17.length)this.$CurationCaretNux17.pop().remove();this.$CurationCaretNux17=null;this.$CurationCaretNux15=null}};F.prototype.$CurationCaretNux14=function(){"use strict";var G=c("Parent").byClass(this.container,n);return c("DataStore").get(G,p)===true};F.saveOptionLoaded=function(G){"use strict";__p&&__p();var H=c("ge")(G);if(H){var I=c("Parent").byClass(H,n);if(I){c("DataStore").set(I,p,true);var J=c("DataStore").get(I,o);J&&J.$CurationCaretNux12()}}};f.exports=F}),null);
__d("XSavedForLaterNUXSeenController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/saved/nuxseen/",{action:{type:"Enum",enumType:1},surface:{type:"Enum",enumType:1},mechanism:{type:"Enum",enumType:1},collection_id:{type:"Enum",enumType:0},object_id:{type:"Int"},interaction_time:{type:"Int"}})}),null);